%title='Better Bashing'
<article>
	<h2>{{ title }}</h2>
	<time>11 January, 2006</time>
	<p>
	<abbr title="Bourne Again SHell">Bash</abbr> is a big part of my life. I spend a huge part of my day interacting with my shell at the command prompt. For years now, Bash has been my shell of choice. That's not to say it's perfect, however. There have been a few nagging deficiencies in Bash that I have been meaning to remedy, and I finally got around to doing just that today. (Relevant config file contents are at the bottom of this post.)<br /><br />One thing that's long annoyed me in Bash is that history searches only show the next match (whether forward or reverse, incremental or not). I want to be able to scroll back through all commands in my history that match a search. It turns out that there are a couple readline builtins that accomplish this: history-search-forward and history-search-backward. (See 'bind -l' for a list of readline commands, by the way.) They are not incremental, but they work well if you know the first few characters of the command, which is the common case for me. I bound these two commands to my up and down arrows using my .inputrc and now the arrow keys scroll through commands in my history that match the first few characters I type at the prompt. It's pretty handy.<br /><br />The next feature I've always wanted in my shell is the equivalent of Ctrl-o and Ctrl-i in vim. Basically it's like the Back and Forward buttons on your web browser. Now, I know most of you are thinking that pushd and popd already get me there, but those commands behave somewhat differently. Read <a href="http://www.faqs.org/docs/bashman/bashref_73.html">the Bash manual</a> for details. What I want is to use cd to change directories, then use Ctrl-o and Ctrl-i to jump back and forward along my directory navigation history. I was going to somehow build this on top of pushd and popd, but I decided to just write my own system instead using a couple of arrays for the stacks. Here is the code, which I've included in my .bash_profile:<br /><br /><code>forward_size=0<br />back_size=0<br />declare -a back_dirs<br />declare -a forward_dirs<br /><br />back_dir()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;if [ $back_size = 0 ]; then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br />&nbsp;&nbsp;&nbsp;&nbsp;fi<br />&nbsp;&nbsp;&nbsp;&nbsp;back_size=$((back_size-1));<br />&nbsp;&nbsp;&nbsp;&nbsp;forward_dirs[$forward_size]=`pwd`;<br />&nbsp;&nbsp;&nbsp;&nbsp;forward_size=$((forward_size+1));<br />&nbsp;&nbsp;&nbsp;&nbsp;builtin cd ${back_dirs[$back_size]};<br />}<br /><br />forward_dir()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;if [ $forward_size = 0 ]; then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br />&nbsp;&nbsp;&nbsp;&nbsp;fi<br />&nbsp;&nbsp;&nbsp;&nbsp;forward_size=$((forward_size-1));<br />&nbsp;&nbsp;&nbsp;&nbsp;back_dirs[$back_size]=`pwd`;<br />&nbsp;&nbsp;&nbsp;&nbsp;back_size=$((back_size+1));<br />&nbsp;&nbsp;&nbsp;&nbsp;builtin cd ${forward_dirs[$forward_size]};<br />}<br /><br />cd()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;wd=`pwd`;<br />&nbsp;&nbsp;&nbsp;&nbsp;builtin cd "$@";<br />&nbsp;&nbsp;&nbsp;&nbsp;if [ $? = "0" ]; then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;back_dirs[$back_size]=$wd;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;back_size=$((back_size+1));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forward_size=0;<br />&nbsp;&nbsp;&nbsp;&nbsp;fi<br />}<br /><br /></code>Using my new version of cd and binding my new functions back_dir and forward_dir to some keys (I ended up using Ctrl-f and Ctrl-b, also vi-inspired) I now have the behavior I was looking for. Here are the contents of my .inputrc:<br /><br /><code>$include /etc/inputrc<br />"\M-[B":&nbsp;&nbsp;&nbsp;history-search-forward<br />"\M-[A":&nbsp;&nbsp;&nbsp;history-search-backward<br />"\C-b":&nbsp;&nbsp;&nbsp;&nbsp;"back_dir^M"<br />"\C-f":&nbsp;&nbsp;&nbsp;&nbsp;"forward_dir^M"<br />"\M-i":&nbsp;&nbsp;&nbsp;&nbsp;kill-whole-line<br /></code><br />Note that I also bound Meta-i to kill-whole-line, which is too useful of a command to be unbound (yet it is unbound by default). There is probably a much simpler way of doing this, but this was easy enough and it works great. Try it out and let me know what you think.
	</p>
</article>
%rebase view/base title=title
